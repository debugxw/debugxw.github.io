

<!DOCTYPE html>
<html lang="en" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Git数据清理 - 读万卷书，行万里路</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content="前段时间在一个新项目中，把项目的可执行程序放进了git...">
  <meta name="author" content="John Doe">
  <link rel="icon" href="/img/icons/favicon-32x32.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/img/icons/favicon-64x64.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/img/icons/favicon-128x128.png" sizes="180x180">
  <meta rel="mask-icon" href="/img/icons/favicon-128x128.png" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/img/icons/favicon-128x128.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="https://at.alicdn.com/t/font_1445822_p6ry5n7lrr.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/github.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/github-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      loading: {
        gif: '/img/theme/loading.gif',
        lottie: ''
      },
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: {
          gif: '/img/theme/loading.gif',
          lottie: ''
        }
      },
      donate: {
        enable: true,
        alipay: 'https://pic.izhaoo.com/alipay.jpg',
        wechat: 'https://pic.izhaoo.com/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: '我在开了灯的床头下，想问问自己的心啊。',
          typing: true,
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: false,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'default'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: false,
        path: ''
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 7.3.0"></head>

<body class="lock-screen">
  <div class="loading" id="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
      
        <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i>
      
      
    </div>
    <div class="center">Git数据清理</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/tags/ " class="underline "> 标签</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="/img/theme/031.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">Git数据清理</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>February 05, 2023</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>12341</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        
          <p>优化存储空间、提升操作效率、确保团队协作的顺畅性</p>
        
        <p>前段时间在一个新项目中，把项目的可执行程序放进了git仓库中，虽然占用空间不是很大，但还是想着把它给删除掉。Google一番之后，发现大多文章写的让人云里雾里，索性先来整理下Git内部原理</p>
<h2 id="一、Git原理分析"><a href="#一、Git原理分析" class="headerlink" title="一、Git原理分析"></a>一、Git原理分析</h2><h3 id="1-1、存储机制"><a href="#1-1、存储机制" class="headerlink" title="1.1、存储机制"></a>1.1、存储机制</h3><p>从本质上来讲Git是一个内容寻址（content-addressable）文件系统，并在此之上提供了一个版本控制系统。其核心部分是一个简单的键值对数据库（位于<code>.git/objects</code>目录下），我们可以向Git仓库中插入任意类型的内容，它会返回一个唯一的键，通过该键可以在任意时刻再次取回该内容</p>
<h4 id="1-1-1、数据对象"><a href="#1-1-1、数据对象" class="headerlink" title="1.1.1、数据对象"></a>1.1.1、数据对象</h4><p>Git会对原始文件做一系列处理，然后得到一个长度为40位的SHA-1校验和&#x2F;哈希值。并以前两位作为目录，后38位作为文件名，将原始文件经过一系列处理得到的数据存储在<code>.git/objects</code>目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">➜ find .git/objects<br>.git/objects<br>.git/objects/92<br>.git/objects/92/56a0a5660f06035d2b410df02fd5e002461718<br>.git/objects/03<br>.git/objects/03/3b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5<br>.git/objects/pack<br>.git/objects/38<br>.git/objects/38/feecbdf638935287fd920e8f2d694aa8c28d9f<br>.git/objects/info<br></code></pre></td></tr></table></figure>

<p>用于存储文件数据的对象即为数据对象（Git称之为Blog），可以通过<code>git cat-file -t</code>命令来查看对象的类型(注意：需要提供40位的SHA-1值)</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">➜ git <span class="hljs-built_in">cat</span><span class="hljs-operator">-file</span> <span class="hljs-literal">-t</span> <span class="hljs-number">033</span>b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5<br>blob<br></code></pre></td></tr></table></figure>

<h4 id="1-1-2、树对象"><a href="#1-1-2、树对象" class="headerlink" title="1.1.2、树对象"></a>1.1.2、树对象</h4><p>对于数据对象，其中只存储了每个文件的数据，但是却并没有存储数据属于哪个文件，也就是我们需要一个地方来存储文件名、文件的目录结构等信息。这就需要用到树对象（Git称之为Tree），一个树对象包含了一条或多条树对象记录，每条记录含有一个指向数据对象或者子树对象的指针，以及相应的模式、类型、文件名信息等。可以通过<code>git cat-file -p master^&#123;tree&#125;</code>命令来查看master分支上最新的提交所指向的树对象</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dos"># 该树对象保存了<span class="hljs-number">1</span>个指向Blob对象的指针和<span class="hljs-number">1</span>个指向<span class="hljs-built_in">Tree</span>对象的指针<br>➜ git cat-file -p master^&#123;<span class="hljs-built_in">tree</span>&#125;<br><span class="hljs-number">040000</span> <span class="hljs-built_in">tree</span> <span class="hljs-number">637</span>c389ee6f1ea958294818793572ca052b11dab	pro<br><span class="hljs-number">100644</span> blob <span class="hljs-number">033</span>b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5	repo.rb<br></code></pre></td></tr></table></figure>

<p>简单来说，Git内部存储的数据类似于</p>
<p><img    class="lazyload" data-original="/../../../../img/tool/git/git-tree.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">存储结构</span></p>
<p>这样，我们就可以通过一个树对象获取到仓库所有文件，简单理解，一个树对象即为该时间点Git仓库的全量快照。再进一步，如果能将这些树对象以链表的形式连接起来，不就可以实现版本控制了么</p>
<h4 id="1-1-3、提交对象"><a href="#1-1-3、提交对象" class="headerlink" title="1.1.3、提交对象"></a>1.1.3、提交对象</h4><p>提交对象（Git称之为Commit）即是将树对象连接起来实现版本控制的大功臣。提交对象的格式很简单：它先指定一个顶层树对象，代表当前项目快照；然后是可能存在的父提交；之后是作者&#x2F;提交者信息（依据你的user.name和user.email配置来设定，外加一个时间戳）；最后是提交注释。<br>至此，我们得到了一个大致完整的Git数据存储结构</p>
<p><img    class="lazyload" data-original="/../../../../img/tool/git/git-commit-tree.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">存储结构</span></p>
<h5 id="全量快照存储"><a href="#全量快照存储" class="headerlink" title="全量快照存储"></a>全量快照存储</h5><p>在我们日常使用Git的过程中，经常会通过UI工具对比不同版本之间的差异，这也很容易造成一个误区：Git对于不同版本的数据是增量存储（即每次提交至保存与上一次提交的差异）。但实际上，对于不同版本的数据Git存储的都是全量的数据，这样有一个明显好处是，在切换版本时不需要逐层计算差异，速度会快上许多。但也有一个显而易见的缺点，存储空间占用较大，当然Git对其也做了一些优化：</p>
<ul>
<li>如果某个文件在上次提交后没有变化，Git不会重新存储该文件的内容，而是复用已有的Blob对象</li>
<li>Blob对象都是使用zlib算法对文件压缩后得到的(经过实测，一个105K的文本文件，zlib压缩之后的Blob文件只有4.5K)</li>
<li>包文件进一步提升存储效率（后文会提到）</li>
</ul>
<blockquote>
<p>Tips<br>曾经有一个困扰我很久的问题，例如一个仓库所有文件一共有10MB，我把这些文件全部删除之后，再提交一个版本，仓库下什么东西都没有了，但是却依然能够回退到上一个10MB的版本，为什么？后来知道了，是因为版本数据是存储在.git目录下的。但是新的问题又来了，我放了一个100MB的文本文件在仓库里，即然版本数据是放在.git目录下的，为什么.git目录占用的空间远小于100MB，现在知道了，原来Git会使用zlib对文件进行压缩（同时还将对象压缩为空间占用更小的包文件）</p>
</blockquote>
<h5 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h5><p>通过提交对象，我们可以在不同版本之间进行切换，只要你记得每个版本的40位哈希值，不过这可能会有点难。如果我们有一个文件来保存这个哈希值，而该文件有一个简单的名字，然后用这个名字指针来替代原始的哈希值的话会更加简单。在Git中，这种简单的名字被称为“引用”，你可以在<code>.git/refs</code>目录下找到这类含有哈希值的文件。这基本就是Git分支的本质：一个指向某一系列提交之首的指针或引用<br>至此，Git存储结构从概念上看起来是这样的</p>
<p><img    class="lazyload" data-original="/../../../../img/tool/git/git-ref-commit-tree.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">概念存储结构</span></p>
<h4 id="1-1-4、标签对象"><a href="#1-1-4、标签对象" class="headerlink" title="1.1.4、标签对象"></a>1.1.4、标签对象</h4><p>标签对象（Git称之为Tag）非常类似于一个提交对象——它包含一个标签创建者信息、一个日期、一段注释信息，以及一个指针。主要的区别在于，标签对象通常指向一个提交对象，而不是一个树对象。它像是一个永不移动的分支引用——永远指向同一个提交对象，只不过给这个提交对象加上一个更友好的名字罢了</p>
<h3 id="1-2、压缩机制"><a href="#1-2、压缩机制" class="headerlink" title="1.2、压缩机制"></a>1.2、压缩机制</h3><p>到这里，我们知道Git管理版本的方式是存储不同版本的全量快照。我们执行的Git命令，也几乎是在往Git数据库中添加数据，即使是删除了某个文件，对于Git来说也是新增存储对象。所以Git仓库会变得越来越大也就容易理解了，但是Git仓库就这样也来越大，而Git却什么都做不了吗？显然不会</p>
<p>Git最初向磁盘中存储对象时所使用的格式被称为松散对象格式。但是，Git会时不时地将多个这些对象打包成一个称为包文件的二进制文件，以节省空间和提高效率。当版本库中有太多的松散对象，或者你手动执行git gc命令，或者你向远程服务器执行推送时，Git都会这样做。举个例子来说明</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vim">➜ git curl https://raw.githubusercontent.<span class="hljs-keyword">com</span>/mojombo/grit/master/lib/grit/repo.rb &gt; repo.rb<br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br><span class="hljs-number">100</span> <span class="hljs-number">22044</span>  <span class="hljs-number">100</span> <span class="hljs-number">22044</span>    <span class="hljs-number">0</span>     <span class="hljs-number">0</span>  <span class="hljs-number">28369</span>      <span class="hljs-number">0</span> --:--:-- --:--:-- --:--:-- <span class="hljs-number">28554</span><br><br>git ✗ ➜ git <span class="hljs-built_in">add</span> --<span class="hljs-keyword">all</span><br><br>git ✗ ➜ git commit -<span class="hljs-keyword">m</span> <span class="hljs-string">&quot;add repo.rb&quot;</span><br>[master（根提交） <span class="hljs-number">8</span>ccf012] <span class="hljs-built_in">add</span> repo.rb<br> <span class="hljs-number">1</span> <span class="hljs-keyword">file</span> changed, <span class="hljs-number">709</span> insertions(+)<br> create <span class="hljs-keyword">mode</span> <span class="hljs-number">100644</span> repo.rb<br><br>➜ git <span class="hljs-keyword">cat</span>-<span class="hljs-keyword">file</span> -<span class="hljs-keyword">p</span> master^&#123;tree&#125;<br><span class="hljs-number">100644</span> blob <span class="hljs-number">033</span>b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5	repo.rb<br><br>➜ <span class="hljs-keyword">ll</span> -h .git/objects/<span class="hljs-number">03</span>/<span class="hljs-number">3</span>b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5<br>-r--r--r--@ <span class="hljs-number">1</span> edy  staff   <span class="hljs-number">6.7</span>K  <span class="hljs-number">2</span>  <span class="hljs-number">7</span> <span class="hljs-number">11</span>:<span class="hljs-number">07</span> .git/objects/<span class="hljs-number">03</span>/<span class="hljs-number">3</span>b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5<br><br>➜ git <span class="hljs-keyword">cat</span>-<span class="hljs-keyword">file</span> -s <span class="hljs-number">033</span>b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5<br><span class="hljs-number">22044</span><br><br>➜ <span class="hljs-keyword">find</span> .git/objects -<span class="hljs-built_in">type</span> <span class="hljs-keyword">f</span><br>.git/objects/<span class="hljs-number">03</span>/<span class="hljs-number">3</span>b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5<br>.git/objects/<span class="hljs-number">38</span>/feecbdf638935287fd920e8f2d694aa8c28d9f<br>.git/objects/<span class="hljs-number">8</span><span class="hljs-keyword">c</span>/cf012107dcbe00554cb2af2c42ed35920fea8d<br></code></pre></td></tr></table></figure>

<p>首先我们往Git仓库里面放了一个大小约为22K的文件，并提交生成一个版本V1。这时我们可以看到Git生成了一个哈希值为033b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5的Blob对象，该对象大小约为6K（注意：<code>git cat-file -s</code>展示的是Blob对象指向的文件的大小，而不是Blob对象本身的大小）(objects目录下的其他两个对象类型分别为Tree和Commit)</p>
<p>接着我们来修改一下repo.rb文件的内容，并提交生成版本V2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">➜ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;add something&#x27;</span> &gt;&gt; repo.rb<br><br>git ✗ ➜ git commit -am <span class="hljs-string">&quot;add something to repo.rb&quot;</span><br>[master 91b2f7a] add something to repo.rb<br> 1 file changed, 1 insertion(+)<br><br>➜ git cat-file -p master^&#123;tree&#125;<br>100644 blob 03c9e1d193bb52be4c31569471ddc641d04ec84b	repo.rb<br><br>➜ ll -h .git/objects/03/c9e1d193bb52be4c31569471ddc641d04ec84b<br>-r--r--r--@ 1 edy  staff   6.7K  2  7 11:21 .git/objects/03/c9e1d193bb52be4c31569471ddc641d04ec84b<br><br>➜ git cat-file -s 03c9e1d193bb52be4c31569471ddc641d04ec84b<br>22058<br><br>➜ find .git/objects -<span class="hljs-built_in">type</span> f<br>.git/objects/03/c9e1d193bb52be4c31569471ddc641d04ec84b<br>.git/objects/03/3b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5<br>.git/objects/38/feecbdf638935287fd920e8f2d694aa8c28d9f<br>.git/objects/91/b2f7a18244790ef199c94ac2308408ac47a0f8<br>.git/objects/de/ae617f7cd38b4cff9d7d8b775197b59c8a57ca<br>.git/objects/8c/cf012107dcbe00554cb2af2c42ed35920fea8d<br></code></pre></td></tr></table></figure>

<p>可以看到，Git在版本V2中又重新生成了一个和V1完全不同的Blob对象，哈希值为03c9e1d193bb52be4c31569471ddc641d04ec84b，很显然这样会占用大量的存储空间。我们可以手动执行<code>git gc</code>命令让Git对对象进行打包，来看看能节约多大的存储空间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">➜ find .git/objects -<span class="hljs-built_in">type</span> f<br>.git/objects/pack/pack-5e6e54b3e45290c8a763c83b308431a063577448.idx<br>.git/objects/pack/pack-5e6e54b3e45290c8a763c83b308431a063577448.pack<br>.git/objects/pack/pack-5e6e54b3e45290c8a763c83b308431a063577448.rev<br>.git/objects/info/commit-graph<br>.git/objects/info/packs<br><br>➜ ll -h .git/objects/pack/pack-5e6e54b3e45290c8a763c83b308431a063577448.pack<br>-r--r--r--@ 1 edy  staff   6.1K  2  7 11:25 .git/objects/pack/pack-5e6e54b3e45290c8a763c83b308431a063577448.pack<br></code></pre></td></tr></table></figure>

<p>可以看到，<code>.git/objects</code>目录下原来的对象不见了，但是在<code>.git/objects/pack</code>下却多了以pack、idx为后缀的文件，这就是打包生成的包文件和一个索引。包文件包含了刚才从文件系统中移除的所有对象的内容。索引文件包含了包文件的偏移信息，我们通过索引文件就可以快速定位任意一个指定对象。有意思的是运行gc命令前磁盘上的对象大小约为13K(6.7K+6.7K)，而这个新生成的包文件大小仅有6.1K。通过打包对象减少了一半的磁盘占用空间</p>
<p>Git是如何做到这点的？Git打包对象时，会查找命名及大小相近的文件，并只保存文件不同版本之间的差异内容。你可以查看包文件，观察它是如何节省空间的。<code>git verify-pack</code>这个底层命令可以让你查看已打包的内容</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dns">➜ git verify-pack -v .git/objects/pack/pack-<span class="hljs-number">5</span>e6e54b3e45290c8a763c83b308431a<span class="hljs-number">063577448</span>.pack<br><span class="hljs-number">91</span>b2f7a18244790ef199c94ac2308408ac47a0f8 commit <span class="hljs-number">217 155 12</span><br><span class="hljs-number">8</span>ccf012107dcbe00554cb2af2c42ed35920fea8d commit <span class="hljs-number">156 114 167</span><br><span class="hljs-number">03</span>c9e1d193bb52be4c31569471ddc641d04ec84b blob   <span class="hljs-number">22058 5801</span> <span class="hljs-number">281</span><br>deae617f7cd38b4cff9d7d8b775197b59c8a57ca tree   <span class="hljs-number">35 46 6082</span><br><span class="hljs-number">38</span>feecbdf638935287fd920e8f2d694aa8c28d9f tree   <span class="hljs-number">35 46 6128</span><br><span class="hljs-number">033</span>b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5 blob   <span class="hljs-number">9 20 6174</span> <span class="hljs-number">1</span> <span class="hljs-number">03</span>c9e1d193bb52be4c31569471ddc641d04ec84b<br>非 delta：<span class="hljs-number">5</span> 个对象<br>链长 = <span class="hljs-number">1</span>: <span class="hljs-number">1</span> 对象<br>.git/objects/pack/pack-<span class="hljs-number">5</span>e6e54b3e45290c8a763c83b308431a<span class="hljs-number">063577448</span>.pack: ok<br></code></pre></td></tr></table></figure>

<p>此处，033b4这个数据对象（即repo.rb文件的版本1）引用了数据对象03c9e，即该文件的版本2。命令输出内容的第四列显示的是各个对象在包文件中的大小，可以看到03c9e占用了5.8K空间，而033b4仅占用20字节。同样有趣的地方在于，第二个版本完整保存了文件内容，而原始的版本反而是以差异方式保存的——这是因为大部分情况下需要快速访问文件的最新版本</p>
<h3 id="1-3、Git-VS-SVN"><a href="#1-3、Git-VS-SVN" class="headerlink" title="1.3、Git VS SVN"></a>1.3、Git VS SVN</h3><p>前文提到对于不同版本的数据Git存储的都是全量的数据，这样有一个明显好处是，在切换版本时不需要逐层计算差异，速度会快上许多。但在上面介绍了包文件的差异&#x2F;增量存储之后，不禁会生成一个疑问：如果没有包文件，那Git的全量存储以及高性能的历史回溯毋庸置疑。但是既然有了包文件并且它的存储机制是增量存储，那在切换历史版本时，不一样需要逐层计算差异吗？就历史回溯这一点来说，Git相比于SVN性能上的优势体现在哪里呢？关键在于一下两点</p>
<h4 id="1-3-1、回溯链路短"><a href="#1-3-1、回溯链路短" class="headerlink" title="1.3.1、回溯链路短"></a>1.3.1、回溯链路短</h4><ul>
<li>Git<ul>
<li>例如有四个版本v1-&gt;v2-&gt;v3-&gt;v4，我们需要回溯到v2，只需要解析v2、v3、v4，而不需要解析历史所有版本</li>
<li>增量深度可控，<code>git repack --depth=50</code>可以设置将增量链的最大深度限制为50<br>假设一个文件有100个版本，且设置–depth&#x3D;50。Git在打包时会自动分割成两个增量链v1-&gt;v50和v51-&gt;v100，每个链的末尾对象v50和v100会被存储为完整对象，而非差异。当我们需要从v100回溯到v1时，由于Tree对象的存在，我可以直接定位到v50，然后从v50解析到v1，这样v51-&gt;v100就不需要被解析</li>
</ul>
</li>
<li>SVN的增量链是全局的，若文件有100个版本，SVN必须从v100逐层计算差异到v1，时间复杂度为O(n)</li>
</ul>
<h4 id="1-3-2、本地操作"><a href="#1-3-2、本地操作" class="headerlink" title="1.3.2、本地操作"></a>1.3.2、本地操作</h4><ul>
<li>Git：分布式。所有数据（包括完整历史和增量）存储在本地，解压操作完全本地化，速度极快</li>
<li>SVN：集中式。历史数据存储在远程服务器，回退时需要从服务器下载差异链，<strong>网络延迟和带宽成为瓶颈</strong></li>
</ul>
<h2 id="二、数据清理"><a href="#二、数据清理" class="headerlink" title="二、数据清理"></a>二、数据清理</h2><h3 id="2-1、filter-branch"><a href="#2-1、filter-branch" class="headerlink" title="2.1、filter-branch"></a>2.1、filter-branch</h3><p>filter-branch是官方提供的一个仓库清理工具，但其性能糟糕且存在大量安全隐患，因此不建议使用，<a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-filter-branch">官方</a>也推荐使用其他的清理工具，如<a target="_blank" rel="noopener" href="https://github.com/newren/git-filter-repo/">filter-repo</a></p>
<h3 id="2-2、filter-repo"><a href="#2-2、filter-repo" class="headerlink" title="2.2、filter-repo"></a>2.2、filter-repo</h3><p><a target="_blank" rel="noopener" href="https://github.com/newren/git-filter-repo/">filter-repo</a>是一款多功能的重写历史工具，它大致属于与filter-branch相同的工具领域，但没有filter-branch那样令人望而却步的糟糕 性能，功能更多，并且其设计可扩展到超越简单重写情况的可用性。Git项目现在推荐使用filter-repo来代替filter-branch</p>
<p>虽然大多数用户可能只会将filter-repo用作简单的命令行工具（并且可能只使用其中的一些功能），但filter-repo的核心包含一个用于创建历史重写工具的库。因此，有特殊需求的用户可以利用它快速创建全新的历史重写工具</p>
<h3 id="2-3、BFG"><a href="#2-3、BFG" class="headerlink" title="2.3、BFG"></a>2.3、BFG</h3><p>BFG是一种更简单、更快捷的替代方法。相较于filter-branch，BFG在执行删除超大文件、密码、凭证、其他四人数据等方面更胜一筹。使用说明可参考<a target="_blank" rel="noopener" href="https://rtyley.github.io/bfg-repo-cleaner/">官方文档</a>，这里不再赘述，但是有两点需要注意</p>
<h4 id="2-3-1、bare-repo"><a href="#2-3-1、bare-repo" class="headerlink" title="2.3.1、bare repo"></a>2.3.1、bare repo</h4><p>再执行一系列命令时，需要使用裸仓库，可以使用如下命令克隆一个裸仓库</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">--mirror</span> git://example.com/some-big-repo.git<br></code></pre></td></tr></table></figure>

<p>在执行克隆仓库时需要加上<code>--mirror</code>参数，此时克隆下来的仓库就不包含工作区，即只有<code>.git</code>目录下的内容<br>当然你也可以添加<code>--bare</code>参数<br>这两个参数唯一的区别是，使用<code>--mirror</code>克隆出来的裸仓库会对远程仓库进行注册，这样就可以使用fetch、pull、push等参数和远程仓库持续同步数据</p>
<h4 id="2-3-2、protected-commit"><a href="#2-3-2、protected-commit" class="headerlink" title="2.3.2、protected commit"></a>2.3.2、protected commit</h4><p>默认情况下，BFG不会修改分支上的最新&#x2F;受保护提交的内容。这是因为最新提交很可能是部署到生产中的提交，而简单删除私人凭证或大文件很可能会导致代码损坏，不再具有它期望的硬编码数据。这时需要我们手动修复它，一旦提交了更改，并且最新提交是干净的，其中没有任何不需要的数据，我们就可以运行BFG对所有历史提交执行简单的删除操作</p>
<p>注意，虽然这些最新&#x2F;受保护的提交中的文件不会被更改，但是当这些提交紧接着之前的脏提交时，它们的提交ID将会更改，以反映更改的历史记，只有文件系统树的哈希值会保持不变</p>
<p>当然如果你想关闭保护（一般不推荐），可以使用<code>--no-blob-protection</code>参数</p>
<h4 id="2-3-3、实操"><a href="#2-3-3、实操" class="headerlink" title="2.3.3、实操"></a>2.3.3、实操</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">~ ➜ <span class="hljs-keyword">ls</span><br>bfg.jar<br><br><span class="hljs-comment"># 克隆裸仓库</span><br>~ ➜ git clone <span class="hljs-params">--mirror</span> git@github.com<span class="hljs-function">:debugxw</span>/debugxw.github.io.git<br>克隆到纯仓库 &#x27;debugxw.github.io.git&#x27;<span class="hljs-string">...</span><br>remote: Enumerating objects: 689, done.<br>remote: Counting objects: 100% <span class="hljs-params">(689/689)</span>, done.<br>remote: Compressing objects: 100% <span class="hljs-params">(319/319)</span>, done.<br>remote: Total 689 <span class="hljs-params">(delta 165)</span>, reused 681 <span class="hljs-params">(delta 157)</span>, pack-reused 0 <span class="hljs-params">(from 0)</span><br>接收对象中: 100% <span class="hljs-params">(689/689)</span>, 12.55 MiB | 3.64 MiB/s, 完成.<br>处理 delta 中: 100% <span class="hljs-params">(165/165)</span>, 完成.<br><br>~ ➜ <span class="hljs-keyword">cd</span> debugxw.github.io.git<br><br>~<span class="hljs-string">/debugxw.github.io.git</span> ➜ git count-objects -vH<br>count: 0<br>size: 0 字节<br>in-pack: 689<br>packs: 1<br>size-pack: 12.57 MiB<br>prune-packable: 0<br>garbage: 0<br>size-garbage: 0 字节<br><br><span class="hljs-comment"># 查找出占用空间最大的1个对象</span><br><span class="hljs-comment"># 这里可以看到563d4这个对象占用了1.9M的空间</span><br>~<span class="hljs-string">/debugxw.github.io.git</span> ➜ git verify-pack -v objects/pack/pack-*<span class="hljs-string">.idx</span> | grep -v chain | sort -k3nr | head -n 1<br>563d4d613144f8f7867de89545a9bc698eed3f7a blob   1978534 1941582 11069837<br><br><span class="hljs-comment"># 查看563d4所对应的文件名</span><br>~<span class="hljs-string">/debugxw.github.io.git</span> ➜ git rev-list <span class="hljs-params">--objects</span> <span class="hljs-params">--all</span> | grep 563d4d613144f8f7867de89545a9bc698eed3f7a<br>563d4d613144f8f7867de89545a9bc698eed3f7a img/theme/026.jpg<br>~<span class="hljs-string">/debugxw.github.io.git</span> ➜ git rev-list <span class="hljs-params">--objects</span> <span class="hljs-params">--all</span> | grep 026.jpg<br>563d4d613144f8f7867de89545a9bc698eed3f7a img/theme/026.jpg<br><br>~<span class="hljs-string">/debugxw.github.io.git</span> ➜ <span class="hljs-keyword">cd</span> <span class="hljs-string">..</span><br><br>~ ➜ <span class="hljs-keyword">ls</span><br>bfg.jar               debugxw.github.io.git<br><br>~ ➜ java -jar bfg.jar <span class="hljs-params">--delete-files</span> 026.jpg debugxw.github.io.git<br><br>Using repo :~<span class="hljs-string">/debugxw.github.io.git</span><br><br>Found 3 objects to protect<br>Found 6 commit-pointing refs : HEAD, refs/heads/<span class="hljs-keyword">deploy</span>, refs/heads/master, <span class="hljs-string">...</span><br>Found 1 tag-pointing refs : refs/tags/2025020701<br><br>Protected commits<br><span class="hljs-params">-----------------</span><br><br>These are your protected commits, and so their contents will NOT be altered:<br><br> * commit e8a9671b <span class="hljs-params">(protected by &#x27;HEAD&#x27;)</span><br><br>Cleaning<br><span class="hljs-params">--------</span><br><br>Found 15 commits<br>Cleaning commits:       100% <span class="hljs-params">(15/15)</span><br>Cleaning commits completed in 46 ms.<br><br>Updating 1 Ref<br><span class="hljs-params">--------------</span><br><br>	Ref                 Before     After<br>	<span class="hljs-params">---------------------------------------</span><br>	refs/heads/<span class="hljs-keyword">deploy</span> | 2646a060 | bf9c44d5<br><br>Updating references:    100% <span class="hljs-params">(1/1)</span><br><span class="hljs-string">...Ref</span> update completed in 4 ms.<br><br>Commit Tree-Dirt History<br><span class="hljs-params">------------------------</span><br><br>	Earliest      Latest<br>	|                  |<br>	<span class="hljs-string">..</span> <span class="hljs-string">..D</span> D.. <span class="hljs-string">..D</span> D.. m<br><br>	D = dirty commits <span class="hljs-params">(file tree fixed)</span><br>	m = modified commits <span class="hljs-params">(commit message or parents changed)</span><br>	. = clean commits <span class="hljs-params">(no changes to file tree)</span><br><br>	                        Before     After<br>	<span class="hljs-params">-------------------------------------------</span><br>	First modified commit | cf4c23bf | ec1edcf2<br>	Last dirty commit     | 2134fc12 | 1b307b75<br><br>Deleted files<br><span class="hljs-params">-------------</span><br><br>	Filename   Git id<br>	<span class="hljs-params">----------------------------</span><br>	026.jpg  | 563d4d61 <span class="hljs-params">(1.9 MB)</span><br><br><br>In total, 14 object ids were changed. Full details are logged here:<br><br>	<span class="hljs-string">/Users/edy/xw/gittest1/debugxw.github.io.git.bfg-report/2025-02-07/16-54-01</span><br><br>BFG run is complete! When ready, run: git reflog expire <span class="hljs-params">--expire=now</span> <span class="hljs-params">--all</span> &amp;&amp; git gc <span class="hljs-params">--prune=now</span> <span class="hljs-params">--aggressive</span><br><br>➜ ~ <span class="hljs-keyword">cd</span> debugxw.github.io.git<br><br><span class="hljs-comment"># BFG 将更新提交以及所有分支和标签，但它不会物理删除不需要的内容</span><br><span class="hljs-comment"># 当你确保历史记录已更新后，可以使用标准git gc命令删除不需要的脏数据</span><br>~<span class="hljs-string">/debugxw.github.io.git</span> ➜ git reflog expire <span class="hljs-params">--expire=now</span> <span class="hljs-params">--all</span> &amp;&amp; git gc <span class="hljs-params">--prune=now</span> <span class="hljs-params">--aggressive</span><br>枚举对象中: 685, 完成.<br>对象计数中: 100% <span class="hljs-params">(685/685)</span>, 完成.<br>使用 8 个线程进行压缩<br>压缩对象中: 100% <span class="hljs-params">(472/472)</span>, 完成.<br>写入对象中: 100% <span class="hljs-params">(685/685)</span>, 完成.<br>Building bitmaps: 100% <span class="hljs-params">(15/15)</span>, 完成.<br>总共 685（差异 170），复用 497（差异 0），包复用 0（来自  0 个包）<br><br><span class="hljs-comment"># 再次查看磁盘空间占用，发现确实少了</span><br>~<span class="hljs-string">/debugxw.github.io.git</span> ➜ git count-objects -vH<br>count: 0<br>size: 0 字节<br>in-pack: 685<br>packs: 1<br>size-pack: 10.66 MiB<br>prune-packable: 0<br>garbage: 0<br>size-garbage: 0 字节<br><br><span class="hljs-comment"># 推送至远程仓库</span><br>~<span class="hljs-string">/debugxw.github.io.git</span> ➜ git push <span class="hljs-params">--mirror</span><br>枚举对象中: 623, 完成.<br>写入对象中: 100% <span class="hljs-params">(623/623)</span>, 10.28 MiB | 3.03 MiB/s, 完成.<br>总共 623（差异 0），复用 0（差异 0），包复用 623（来自  1 个包）<br>remote: Resolving deltas: 100% <span class="hljs-params">(161/161)</span>, done.<br>To github.com<span class="hljs-function">:debugxw</span>/debugxw.github.io.git<br> + 2646a06.<span class="hljs-string">..bf9c44d</span> <span class="hljs-keyword">deploy</span> -&gt; <span class="hljs-keyword">deploy</span> <span class="hljs-params">(forced update)</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>参考<br>  <a target="_blank" rel="noopener" href="https://git-scm.com/book/zh/v2/Git-%e5%86%85%e9%83%a8%e5%8e%9f%e7%90%86-Git-%e5%af%b9%e8%b1%a1">Git内部原理</a><br>  <a target="_blank" rel="noopener" href="https://juejin.cn/post/7024922528514572302#heading-1">git仓库清理–”保姆级”教程</a></p>
</blockquote>

      </section>
      <section class="extra">
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img   class="lazyload" data-original="https://pic.izhaoo.com/alipay.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%98%E5%82%A8/" rel="tag">存储</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li></ul> 

        
  <nav class="nav">
    <a href="/2023/05/14/RocketMQ%E4%B9%8B%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8/"><i class="iconfont iconleft"></i>RocketMQ之消息存储</a>
    <a href="/2022/04/08/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/">分布式锁<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
        <section class="comments">
  
    <div class="btn" id="comments-btn">查看评论</div>
  
  
<div id="valine"></div>
<script defer src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
  window.onload = function () {
    var loadValine = function () {
      new Valine({
        el: '#valine',
        app_id: "cJOoEEu3sAMF6OftYqgFknB0-gzGzoHsz",
        app_key: "vJR5GGKTPoLqB5pwiWlNqsP5",
        placeholder: "雁过留痕",
        avatar: "mp",
        pageSize: "10",
        lang: "zh-CN",
      });
    }
    if ( true ) {
      $("#comments-btn").on("click", function () {
        $(this).hide();
        loadValine();
      });
    } else {
      loadValine();
    }
  };
</script>

</section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Git%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-text">一、Git原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81%E5%AD%98%E5%82%A8%E6%9C%BA%E5%88%B6"><span class="toc-text">1.1、存储机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1%E3%80%81%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1"><span class="toc-text">1.1.1、数据对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2%E3%80%81%E6%A0%91%E5%AF%B9%E8%B1%A1"><span class="toc-text">1.1.2、树对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-3%E3%80%81%E6%8F%90%E4%BA%A4%E5%AF%B9%E8%B1%A1"><span class="toc-text">1.1.3、提交对象</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A8%E9%87%8F%E5%BF%AB%E7%85%A7%E5%AD%98%E5%82%A8"><span class="toc-text">全量快照存储</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-text">引用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-4%E3%80%81%E6%A0%87%E7%AD%BE%E5%AF%B9%E8%B1%A1"><span class="toc-text">1.1.4、标签对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81%E5%8E%8B%E7%BC%A9%E6%9C%BA%E5%88%B6"><span class="toc-text">1.2、压缩机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E3%80%81Git-VS-SVN"><span class="toc-text">1.3、Git VS SVN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1%E3%80%81%E5%9B%9E%E6%BA%AF%E9%93%BE%E8%B7%AF%E7%9F%AD"><span class="toc-text">1.3.1、回溯链路短</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2%E3%80%81%E6%9C%AC%E5%9C%B0%E6%93%8D%E4%BD%9C"><span class="toc-text">1.3.2、本地操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E6%B8%85%E7%90%86"><span class="toc-text">二、数据清理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81filter-branch"><span class="toc-text">2.1、filter-branch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81filter-repo"><span class="toc-text">2.2、filter-repo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E3%80%81BFG"><span class="toc-text">2.3、BFG</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1%E3%80%81bare-repo"><span class="toc-text">2.3.1、bare repo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2%E3%80%81protected-commit"><span class="toc-text">2.3.2、protected commit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3%E3%80%81%E5%AE%9E%E6%93%8D"><span class="toc-text">2.3.3、实操</span></a></li></ol></li></ol></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=894519210 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://www.instagram.com/izhaoo/ "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#DA2E76'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconinstagram "></i>
      </a><a 
        href="https://github.com/zhaoo "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:izhaoo@163.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
  
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
  
    
<script src="/js/color-mode.js"></script>

  
  
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>





  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>








<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>












</html>